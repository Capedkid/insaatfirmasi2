@using InsaatFirmasi.Models
@model IEnumerable<Product>
@{
    var currentLang = Context.Request.Cookies["lang"] as string ?? "tr";

    ViewData["Title"] = currentLang == "en" ? "Product Groups" : "Ürün Gruplarımız";
    ViewData["Description"] = currentLang == "en"
        ? "Modern product groups for plastic drainage channels, manhole chambers and wet area products."
        : "Plastik drenaj kanalları, rögar menhol kutuları ve ıslak zemin ürünleri için modern ürün grupları.";
    ViewData["Keywords"] = currentLang == "en"
        ? "product groups, drainage, manhole, wet areas, plastic construction products"
        : "ürün grupları, drenaj, rögar, ıslak zemin, plastik inşaat ürünleri";

    var categories = ViewBag.Categories as List<Category> ?? new List<Category>();
    var pageSize = 12;
    var currentPage = ViewBag.CurrentPage is int cp && cp > 0 ? cp : 1;
    var totalCategories = categories.Count;
    var totalPages = (int)Math.Ceiling((double)totalCategories / pageSize);
    var pagedCategories = categories
        .Skip((currentPage - 1) * pageSize)
        .Take(pageSize)
        .ToList();
}

<!-- SAYFA HERO -->
<section class="page-hero page-hero-simple">
    <div class="container-xl text-center">
        <h1 class="page-hero-title">
            @(currentLang == "en" ? "Product Groups" : "Ürün Gruplarımız")
        </h1>
    </div>
</section>

<!-- ÜRÜN GRUPLARI KARTLARI -->
<section class="home-section product-list-section">
    <div class="container-xl">
        <div class="home-section-header">
            <span class="home-section-kicker">
                @(currentLang == "en" ? "Product Groups" : "Ürün Gruplarımız")
            </span>
        </div>

        @if (categories.Any())
        {
            <div class="row g-4">
                @foreach (var category in pagedCategories)
                {
                    <div class="col-lg-4 col-md-6">
                        <a asp-controller="Product" asp-action="Category" asp-route-id="@category.Id" class="text-decoration-none text-reset">
                            <div class="product-group-card">
                                <div class="product-group-image">
                                    @if (!string.IsNullOrEmpty(category.ImagePath))
                                    {
                                        <img src="~/@category.ImagePath" alt="@category.Name" />
                                    }
                                    else if (!string.IsNullOrEmpty(category.ImageUrl))
                                    {
                                        <img src="@category.ImageUrl" alt="@category.Name" />
                                    }
                                    else
                                    {
                                        <div class="d-flex align-items-center justify-content-center h-100 text-muted">
                                            <i class="fas fa-layer-group fa-2x"></i>
                                        </div>
                                    }
                                </div>
                                <h3>@category.Name</h3>
                            </div>
                        </a>
                    </div>
                }
            </div>

            @if (totalPages > 1)
            {
                <nav aria-label="Ürün grupları sayfalama" class="mt-4">
                    <ul class="pagination justify-content-center">
                        @if (currentPage > 1)
                        {
                            <li class="page-item">
                                <a class="page-link"
                                   asp-action="Index"
                                   asp-route-page="@(currentPage - 1)">
                                    Önceki
                                </a>
                            </li>
                        }

                        @for (int i = 1; i <= totalPages; i++)
                        {
                            <li class="page-item @(i == currentPage ? "active" : "")">
                                <a class="page-link"
                                   asp-action="Index"
                                   asp-route-page="@i">
                                    @i
                                </a>
                            </li>
                        }

                        @if (currentPage < totalPages)
                        {
                            <li class="page-item">
                                <a class="page-link"
                                   asp-action="Index"
                                   asp-route-page="@(currentPage + 1)">
                                    Sonraki
                                </a>
                            </li>
                        }
                    </ul>
                </nav>
            }
        }
        else
        {
            <div class="text-center text-muted py-5">
                <i class="fas fa-layer-group fa-3x mb-3"></i>
                <h4>
                    @(currentLang == "en" ? "No category has been added yet" : "Henüz kategori eklenmemiş")
                </h4>
                <p>
                    @(currentLang == "en"
                        ? "When you add new categories from the admin panel, your product groups will be listed here."
                        : "Admin panel üzerinden yeni kategori eklediğinizde ürün gruplarınız burada listelenecektir.")
                </p>
            </div>
        }
    </div>
</section>
